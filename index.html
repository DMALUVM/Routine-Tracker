<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Routine Tracker 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #007bff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        #summary {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 900px;
        }
        #summary h2 {
            margin-top: 0;
        }
        .streak-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .streak-item {
            background: #e9f7ff;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .streak-item h4 {
            margin: 0 0 5px;
            color: #007bff;
        }
        .streak-number {
            font-size: 2em;
            color: #28a745;
        }
        #progress-chart {
            max-width: 800px;
            margin: 20px auto;
        }
        #calendar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1200px;
        }
        .month {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .month h3 {
            text-align: center;
            margin: 0 0 10px;
            color: #007bff;
        }
        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        .day-header {
            text-align: center;
            font-weight: bold;
            color: #666;
        }
        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s, background 0.3s;
            font-size: 1em;
            position: relative;
        }
        .day:hover {
            transform: scale(1.1);
        }
        .past { background: #f8f9fa; }
        .today { border: 2px solid #007bff; }
        .future { background: #e9ecef; cursor: not-allowed; }
        .complete { background: #28a745; color: white; }
        .partial { background: #ffc107; color: black; }
        .missed { background: #dc3545; color: white; }
        .completion-emoji {
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 0.8em;
        }
        #modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #modal.show {
            opacity: 1;
        }
        #modal-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transform: scale(0.9);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }
        #modal.show #modal-content {
            transform: scale(1);
            opacity: 1;
        }
        #modal-content h2 {
            margin-top: 0;
        }
        .routine-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            transition: background 0.3s;
        }
        .routine-item input {
            margin-right: 10px;
        }
        .routine-item label {
            flex: 1;
            display: flex;
            align-items: center;
        }
        .routine-emoji {
            margin-right: 8px;
            font-size: 1.2em;
        }
        .routine-item.completed {
            background: #d4edda;
        }
        .conditional-note {
            font-size: 0.8em;
            color: #666;
            margin-left: 10px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            transition: background 0.3s;
        }
        button:hover {
            background: #0056b3;
        }
        #close-btn {
            background: #6c757d;
        }
        #close-btn:hover {
            background: #5a6268;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <h1>Routine Tracker 2026</h1>
    <div id="summary">
        <h2>Yearly Summary</h2>
        <div class="streak-container"></div>
        <canvas id="progress-chart"></canvas>
    </div>
    <div id="calendar"></div>
    <div id="modal">
        <div id="modal-content">
            <h2 id="modal-title">Edit Routines for Date</h2>
            <div id="routines-list"></div>
            <button id="save-btn">Save</button>
            <button id="close-btn">Close</button>
        </div>
    </div>

    <script>
        const year = 2026;
        const storageKey = 'routineStats2026';

        const routines = {
            daily: [
                { name: 'Lymphatic morning movement', emoji: 'ðŸƒâ€â™‚ï¸' },
                { name: 'Weight training', emoji: 'ðŸ‹ï¸â€â™‚ï¸' },
                { name: 'Nattokinase in the morning', emoji: 'ðŸ’Š' },
                { name: 'Magnesium in the evening', emoji: 'ðŸŒ™' },
                { name: 'Breathwork/meditation', emoji: 'ðŸ§˜â€â™‚ï¸' },
                { name: 'Creatine', emoji: 'ðŸ¥¤' },
                { name: 'Collagen', emoji: 'ðŸ§´' },
                { name: 'Reading before bed', emoji: 'ðŸ“–' }
            ],
            mwf: [
                { name: 'Test & HCG', emoji: 'ðŸ’‰', note: '(M/W/F only)' }
            ],
            weekly: [
                { name: 'Neurofeedback', emoji: 'ðŸ§ ', goal: 5, note: '(5 days a week)' }
            ],
            variable: [
                { name: 'Sauna', emoji: 'ðŸ§–â€â™‚ï¸' }
            ]
        };

        let stats = JSON.parse(localStorage.getItem(storageKey)) || {};
        let progressChart;

        function getDaysInMonth(month) {
            return new Date(year, month, 0).getDate();
        }

        function getFirstDayOfMonth(month) {
            return new Date(year, month - 1, 1).getDay();
        }

        function formatDate(month, day) {
            return `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }

        function getTodayInEST() {
            const formatter = new Intl.DateTimeFormat('en-US', {
                timeZone: 'America/New_York',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
            const parts = formatter.formatToParts(new Date());
            const map = new Map(parts.map(p => [p.type, p.value]));
            return `${map.get('year')}-${map.get('month')}-${map.get('day')}`;
        }

        function isPast(date) {
            const today = getTodayInEST();
            return date < today;
        }

        function isToday(dateStr) {
            const today = getTodayInEST();
            return dateStr === today;
        }

        function getDayOfWeek(dateStr) {
            return new Date(dateStr).getDay(); // 0=Sun,1=Mon,...
        }

        function getWeekNumber(dateStr) {
            const d = new Date(dateStr);
            d.setHours(0, 0, 0, 0);
            d.setDate(d.getDate() + 4 - (d.getDay() || 7)); // Adjust for Monday start
            const yearStart = new Date(d.getFullYear(), 0, 1);
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function calculateStreaks() {
            const todayStr = getTodayInEST();
            const streaks = {};
            const allRoutines = [...routines.daily, ...routines.mwf, ...routines.variable, ...routines.weekly].map(r => r.name);

            allRoutines.forEach(name => {
                streaks[name] = 0;
            });

            let date = new Date(todayStr);
            while (date >= new Date(year, 0, 1)) {
                const dateKey = date.toISOString().split('T')[0];
                const entry = stats[dateKey] || {};
                let allCompleted = true;

                allRoutines.forEach(name => {
                    if (entry[name]) {
                        streaks[name]++;
                    } else {
                        allCompleted = false;
                    }
                });

                if (!allCompleted) break; // Stop if not all completed on this day
                date.setDate(date.getDate() - 1);
            }

            return streaks;
        }

        function calculateWeeklyProgress() {
            const progress = {};
            routines.weekly.forEach(r => {
                progress[r.name] = 0;
            });

            const todayStr = getTodayInEST();
            const currentWeek = getWeekNumber(todayStr);
            routines.weekly.forEach(r => {
                Object.entries(stats).forEach(([dateKey, entry]) => {
                    if (getWeekNumber(dateKey) === currentWeek && entry[r.name]) {
                        progress[r.name]++;
                    }
                });
            });

            return progress;
        }

        function updateSummary() {
            const streakContainer = document.querySelector('.streak-container');
            streakContainer.innerHTML = '';
            const streaks = calculateStreaks();

            Object.entries(streaks).forEach(([name, count]) => {
                const item = document.createElement('div');
                item.classList.add('streak-item');
                item.innerHTML = `
                    <h4>${name}</h4>
                    <div class="streak-number">${count}</div>
                    <p>Day Streak ðŸ”¥</p>
                `;
                streakContainer.appendChild(item);
            });
        }

        function updateProgressChart() {
            const dates = [];
            const completions = [];
            let date = new Date(year, 0, 1);
            const todayStr = getTodayInEST();
            const today = new Date(todayStr);

            while (date <= today) {
                const dateKey = date.toISOString().split('T')[0];
                dates.push(dateKey);
                const entry = stats[dateKey] || {};
                const dow = getDayOfWeek(dateKey);
                const totalDaily = routines.daily.length;
                const totalMWF = [1,3,5].includes(dow) ? routines.mwf.length : 0;
                const totalWeekly = routines.weekly.length; // Always include, but optional
                const totalVariable = entry['Sauna'] ? 1 : 0;
                const total = totalDaily + totalMWF + totalWeekly + totalVariable;
                const completed = Object.values(entry).filter(v => v).length;
                completions.push((completed / total) * 100 || 0);
                date.setDate(date.getDate() + 1);
            }

            const data = {
                labels: dates.map(d => new Date(d).toLocaleDateString('en-US', {month: 'short', day: 'numeric'})),
                datasets: [{
                    label: 'Daily Completion %',
                    data: completions,
                    borderColor: '#007bff',
                    backgroundColor: 'rgba(0,123,255,0.1)',
                    fill: true,
                    tension: 0.3
                }]
            };

            if (progressChart) {
                progressChart.data = data;
                progressChart.update();
            } else {
                const ctx = document.getElementById('progress-chart').getContext('2d');
                progressChart = new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        scales: {
                            y: { min: 0, max: 100, title: { display: true, text: '%' } }
                        }
                    }
                });
            }
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';

            for (let month = 1; month <= 12; month++) {
                const monthDiv = document.createElement('div');
                monthDiv.classList.add('month');

                const monthName = new Date(year, month - 1, 1).toLocaleString('default', { month: 'long' });
                const h3 = document.createElement('h3');
                h3.textContent = `${monthName} ${year}`;
                monthDiv.appendChild(h3);

                const daysGrid = document.createElement('div');
                daysGrid.classList.add('days');

                ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                    const header = document.createElement('div');
                    header.classList.add('day-header');
                    header.textContent = day;
                    daysGrid.appendChild(header);
                });

                const firstDay = getFirstDayOfMonth(month);
                const daysInMonth = getDaysInMonth(month);

                for (let i = 0; i < firstDay; i++) {
                    const empty = document.createElement('div');
                    daysGrid.appendChild(empty);
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = formatDate(month, day);
                    const dayDiv = document.createElement('div');
                    dayDiv.classList.add('day');
                    dayDiv.textContent = day;

                    if (isToday(dateKey)) {
                        dayDiv.classList.add('today');
                    }

                    if (isPast(dateKey) || isToday(dateKey)) {
                        dayDiv.classList.add('past');
                        const entry = stats[dateKey] || {};
                        const dow = getDayOfWeek(dateKey);
                        const totalDaily = routines.daily.length;
                        const totalMWF = [1,3,5].includes(dow) ? routines.mwf.length : 0;
                        const totalWeekly = routines.weekly.length;
                        const totalVariable = entry['Sauna'] ? 1 : 0;
                        const total = totalDaily + totalMWF + totalWeekly + totalVariable;
                        const completed = Object.values(entry).filter(v => v).length;

                        if (completed === total) {
                            dayDiv.classList.add('complete');
                            dayDiv.title = 'All routines completed!';
                            const emoji = document.createElement('span');
                            emoji.classList.add('completion-emoji');
                            emoji.textContent = 'âœ…';
                            dayDiv.appendChild(emoji);
                        } else if (completed > 0) {
                            dayDiv.classList.add('partial');
                            dayDiv.title = `${completed}/${total} routines completed`;
                            const emoji = document.createElement('span');
                            emoji.classList.add('completion-emoji');
                            emoji.textContent = 'â³';
                            dayDiv.appendChild(emoji);
                        } else {
                            dayDiv.classList.add('missed');
                            dayDiv.title = 'No routines completed';
                            const emoji = document.createElement('span');
                            emoji.classList.add('completion-emoji');
                            emoji.textContent = 'âŒ';
                            dayDiv.appendChild(emoji);
                        }
                        dayDiv.onclick = () => openModal(dateKey, entry);
                    } else {
                        dayDiv.classList.add('future');
                    }

                    daysGrid.appendChild(dayDiv);
                }

                monthDiv.appendChild(daysGrid);
                calendar.appendChild(monthDiv);
            }

            updateSummary();
            updateProgressChart();
        }

        function openModal(date, entry = {}) {
            document.getElementById('modal-title').textContent = `Edit Routines for ${date}`;
            const list = document.getElementById('routines-list');
            list.innerHTML = '';

            // Daily routines
            routines.daily.forEach(r => {
                const item = createRoutineItem(r.name, r.emoji, entry[r.name] || false);
                list.appendChild(item);
            });

            // M/W/F
            const dow = getDayOfWeek(date);
            if ([1,3,5].includes(dow)) {
                routines.mwf.forEach(r => {
                    const item = createRoutineItem(r.name, r.emoji, entry[r.name] || false, r.note);
                    list.appendChild(item);
                });
            }

            // Weekly
            routines.weekly.forEach(r => {
                const item = createRoutineItem(r.name, r.emoji, entry[r.name] || false, r.note);
                list.appendChild(item);
            });

            // Variable
            routines.variable.forEach(r => {
                const item = createRoutineItem(r.name, r.emoji, entry[r.name] || false);
                list.appendChild(item);
            });

            const modal = document.getElementById('modal');
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
            modal.dataset.date = date;
        }

        function createRoutineItem(name, emoji, checked, note = '') {
            const div = document.createElement('div');
            div.classList.add('routine-item');
            if (checked) div.classList.add('completed');

            const input = document.createElement('input');
            input.type = 'checkbox';
            input.checked = checked;
            input.onchange = () => {
                if (input.checked) {
                    div.classList.add('completed');
                } else {
                    div.classList.remove('completed');
                }
            };

            const label = document.createElement('label');
            label.innerHTML = `<span class="routine-emoji">${emoji}</span> ${name}`;
            if (note) {
                const noteSpan = document.createElement('span');
                noteSpan.classList.add('conditional-note');
                noteSpan.textContent = note;
                label.appendChild(noteSpan);
            }

            div.appendChild(input);
            div.appendChild(label);
            return div;
        }

        document.getElementById('save-btn').onclick = () => {
            const date = document.getElementById('modal').dataset.date;
            const entry = {};
            const items = document.querySelectorAll('.routine-item');
            items.forEach(item => {
                const labelText = item.querySelector('label').textContent;
                const name = labelText.split(' (')[0].trim().split(' ').slice(1).join(' ');
                const checkbox = item.querySelector('input');
                if (checkbox.checked) {
                    entry[name] = true;
                }
            });
            stats[date] = entry;
            if (Object.keys(entry).length === 0) delete stats[date];
            localStorage.setItem(storageKey, JSON.stringify(stats));
            closeModal();
            renderCalendar();
        };

        document.getElementById('close-btn').onclick = closeModal;

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        // Initial render
        renderCalendar();
    </script>
</body>
</html>
